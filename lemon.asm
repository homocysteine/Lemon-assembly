data segment
   sound dw 82h,92h,0a4h,0aeh,0c4h,0dch,0f6h,105h,125h,149h,15dh,188h,1b8h,1edh,20bh,24bh,293h,2bah,30fh,370h,3dbh,370,416,1097
   index dw 28,30,32,32,28,24,24,30,30,26,26,22,18,18,26,26,24,24,22,14,14,22,22,18,18,18,18,18,18
   dw 16,18,20,20,20,20,28,28,26,28,22,22,22,22,20,20,18,20,42,42,42,42,28,28,26,24,44,44,44,44,44,44
   dw 28,30,32,32,28,24,24,30,30,26,26,22,18,18,26,26,24,24,22,14,14,22,22,18,18,18,18,18,18
   dw 16,18,20,20,20,20,22,22,20,22,18,18,22,22,28,28,32,32,30,30,30,48,30,48,30,28,28,48,28,28,28,28,28,28,28,28,28
   dw 48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48
   dw 28,30,32,32,28,24,24,30,30,26,26,22,18,18,26,26,24,24,22,14,14,22,22,18,18,18,18,18,18
   dw 16,18,20,20,20,20,28,28,26,28,22,22,22,22,20,20,18,20,42,42,42,42,28,28,26,24,44,44,44,44,44,44
   dw 28,30,32,32,28,24,24,30,30,26,26,22,18,18,26,26,24,24,22,14,14,22,22,18,18,18,18,18,18
   dw 16,18,20,20,20,20,22,22,20,22,18,18,22,22,28,28,32,32,30,48,30,30,30,48,30,28,28,28,48,28,28,28,28,28,28,28,28 
   dw 24,24,24,26,28,28,26,24,22,22,32,32,48,32,32,32,32
   dw 30,30,30,32,34,34,32,30,28,28,30,30,22,22,22,22
   dw 20,20,20,22,24,24,22,20,18,18,28,28,48,28,28,48,28,28,26,26,26,26,24,24,26,26,28,28,48,48,48,48,48,48,48,48
   dw 30,32,30,28,24,28,28,28,32,36,36,36,30,28,28,28
   dw 30,32,30,28,24,28,28,28,32,36,36,36,30,28,28,28
   dw 30,32,30,28,24,28,28,28,32,36,36,36,38,36,36,36,48,36,46,46,46,40,36,36,36,32,36,36,30,30,30,30,30
   dw 30,32,30,28,24,28,28,28,32,36,36,36,30,28,28,28
   dw 28,48,28,30,32,34,32,32,32,30,26,26,26,28,28,28,28,28,28
   dw 28,26,24,24,26,26,28,28,30,30,28,28,22,22,18,22,22,22,24,30,30,30,26,28,28,28,48,28,28,28,28,28,28
   dw 28,26,24,24,26,26,28,28,30,30,28,28,22,22,28,30,30,30,32,34,34,34,30,28,28,28,48,28,28,28,28,28,28                                                                                        
   len equ $-index
data ends

code segment
assume cs:code,ds:data
start:
mov ax,data
mov ds,ax
mov di,0 
mov al,0b6h ;计数器2为方式2，初始化
out 43h,al ;写入方式控制字 

mov cx,len/2

n1:
push cx ;保护循环变量 
mov di,index[si]
push si
cmp di,48

jnz loud
call hold ;调用“空子程序” 
jmp silence

loud:
call sing ;调用“唱子程序”

silence:
pop si
inc si 
inc si
pop cx 
loop n1

mov ax,4c00h
int 21h


hold proc ;空
mov ah, 00h
int 1ah
mov si,dx ;读取一个时钟 
   
s0:
mov ah,00h;再读取一个时钟
int 1ah
sub dx,si
mov bx,dx
cmp bl,1h;用差值作为结束标志
jnb m0
loop s0 
m0:
ret 
hold endp


sing proc
;mov al,0b6h ;计数器2为方式2，初始化
;out 43h,al ;写入方式控制字
mov dx,0012h;基准频率高16位
mov ax,2870h;基准频率低16位 
mov bx,sound[di];82h
div bx
;mov ax,34dch
out 42h,al ;写入低字节计数器
mov al,ah                                       
out 42h,al ;写入高字节计数器
in al,61h ;PB的端口地址
or AL,00000011b ;11时扬声器才能发声
out 61H,AL ;直接控制发声 
;push cx
mov ah, 00h
int 1ah
mov si,dx ;读取一个时钟 
   
s1:
mov ah,00h;再读取一个时钟
int 1ah
sub dx,si
mov bx,dx
cmp bl,4h;用差值作为结束标志
jnb m1
loop s1 

m1:
and AL,00000000B ;00时扬声器停止发声
out 61H,AL ;关闭发声

ret
sing endp 
 
 ;pop cx
 ;inc di
 ;loop s2
code ends
end start


